# Inertia Linter — Activity Log
# Excalibrain-compatible tag network for knowledge navigation
# Generated: 2026-02-14
#
# Navigation guide:
#   Start at any tag, follow connects_to edges to find related work.
#   Every tag is reachable from "project" in <= 3 hops.
#   Every activity carries tags for bidirectional lookup.

meta:
  project: inertia-linter
  hackathon: cerebral-valley-ai-2026
  creator: "Yusuke Fukushima MD"
  generated_at: "2026-02-14T22:30:00Z"
  updated_at: "2026-02-15T09:45:00Z"
  total_tasks: 25
  total_tests: 323
  engine_coverage: "100% statements, 96.81% branches"

# ===== TAG NETWORK =====
# 24 tags forming a dense, navigable knowledge graph.
# Level 0: project
# Level 1: engine, ui, safety, data, testing, deployment
# Level 2: clinical-logic, visualization, phi-protection, no-blame, guidelines, blockers, tdd, immutability, i18n, fhir, design
# Level 3: hfref, hfpef, gdmt-score, inertia-buster, mascot, pre-visit-note

tags:
  - id: project
    label: "Inertia Linter"
    description: "Clinical inertia auditor for HF GDMT — detects stalled therapy, classifies blockers, surfaces missing info"
    connects_to: [engine, ui, safety, data, testing, deployment]

  - id: engine
    label: "Rule Engine"
    description: "Deterministic pure functions for GDMT audit — zero side effects, zero external dependencies"
    connects_to: [project, clinical-logic, testing, immutability, blockers]

  - id: ui
    label: "User Interface"
    description: "React 19 + Tailwind 4 three-pane dashboard — form, pillar cards, detail panel, top nav, mascot, pre-visit note"
    connects_to: [project, visualization, safety, no-blame, i18n, design, mascot, pre-visit-note]

  - id: safety
    label: "Safety Design"
    description: "6 non-negotiable safety UI elements, PHI isolation, no-blame language"
    connects_to: [project, phi-protection, no-blame, ui, deployment]

  - id: data
    label: "Structured Data"
    description: "Ruleset JSON, synthetic cases, expected outputs, inertia buster content, guideline differences"
    connects_to: [project, guidelines, clinical-logic, engine]

  - id: testing
    label: "Testing"
    description: "323 Vitest tests across 25 files, TDD workflow (RED-GREEN-REFACTOR), integration tests for 3 demo cases"
    connects_to: [project, engine, tdd, immutability]

  - id: deployment
    label: "Deployment"
    description: "Vite build, Vercel deploy target, LLM integration, export formats, FHIR CarePlan export"
    connects_to: [project, safety, phi-protection, fhir, i18n]

  - id: clinical-logic
    label: "Clinical Logic"
    description: "EF classification, pillar evaluation, blocker detection, dose tier matching, eGFR thresholds"
    connects_to: [engine, data, hfref, hfpef, gdmt-score, blockers]

  - id: visualization
    label: "Visualization"
    description: "Pillar status cards with color coding, GDMT score display, pictograph, guideline comparison"
    connects_to: [ui, inertia-buster, guidelines, gdmt-score]

  - id: phi-protection
    label: "PHI Protection"
    description: "Patient values never leave client. LLM receives only abstract status codes. No patient data in API calls."
    connects_to: [safety, engine, deployment]

  - id: no-blame
    label: "No-Blame Language"
    description: "CLINICAL_INERTIA displayed as 'No identified blocker'. Tool audits, never accuses."
    connects_to: [safety, ui, blockers, inertia-buster]

  - id: guidelines
    label: "Multi-Guideline"
    description: "AHA 2022 + ESC 2021/2023/2024 + ACC ECDP 2024. Differences shown side-by-side, never hidden."
    connects_to: [data, clinical-logic, visualization, hfpef]

  - id: blockers
    label: "Blocker System"
    description: "15 blocker codes (BP_LOW, HR_LOW, K_HIGH, EGFR_LOW_INIT/CONT, ADR_HISTORY, etc.) classifying why GDMT stalls"
    connects_to: [clinical-logic, engine, no-blame, inertia-buster]

  - id: tdd
    label: "Test-Driven Development"
    description: "Every engine function: write test first (RED), implement (GREEN), refactor. 80%+ coverage target."
    connects_to: [testing, engine, immutability]

  - id: immutability
    label: "Immutability"
    description: "All engine functions are pure — never mutate input, always return new objects. Spread operators everywhere."
    connects_to: [engine, testing, tdd]

  - id: hfref
    label: "HFrEF"
    description: "EF <= 40%. Full 4-pillar audit (ARNI/ACEi/ARB, BB, MRA, SGLT2i). Cases 1 and 3."
    connects_to: [clinical-logic, gdmt-score, blockers]

  - id: hfpef
    label: "HFpEF"
    description: "EF >= 50%. SGLT2i audit + finerenone opportunity. Separate HFpEF Management Score. Case 2."
    connects_to: [clinical-logic, guidelines, gdmt-score]

  - id: gdmt-score
    label: "GDMT Score"
    description: "0-100 composite: 25pts per pillar (NOT_PRESCRIBED=0, LOW=8, MED=16, HIGH=25). CONTRA excluded from denominator."
    connects_to: [clinical-logic, visualization, hfref, hfpef]

  - id: inertia-buster
    label: "Inertia Buster"
    description: "Barrier-specific clinical information for physician consideration — NOT counter-arguments or recommendations"
    connects_to: [visualization, blockers, no-blame, data]

  - id: i18n
    label: "Internationalization"
    description: "i18next + react-i18next. EN/JA dual language with runtime switching. TypeScript strict literal key types."
    connects_to: [ui, project, deployment]

  - id: fhir
    label: "FHIR R4"
    description: "HL7 FHIR R4 integration — mock Patient bundles, CarePlan export, LOINC-coded observations"
    connects_to: [data, deployment, phi-protection, pre-visit-note]

  - id: design
    label: "Clinical Design Profile"
    description: "Humanist typography (Lato + Noto Sans JP), teal primary palette, border-over-shadow, Roboto Mono for tabular numbers"
    connects_to: [ui, visualization, project]

  - id: mascot
    label: "Mascot (Rive)"
    description: "Duolingo-style animated character via Rive. State-machine driven emotions reacting to audit state."
    connects_to: [ui, engine, visualization]

  - id: pre-visit-note
    label: "Pre-Visit Planning Note"
    description: "Auto-generated medication adjustment plan + patient explanation memo → FHIR CarePlan export to EHR"
    connects_to: [engine, fhir, phi-protection, ui]

# ===== ACTIVITY LOG =====
# Each activity maps to a team task with full traceability.
# Tasks numbered TASK-01 through TASK-24 correspond to the 24 completed team tasks.
# TASK-01~16: MVP (Session 1) | TASK-17~24: Enhancement (Session 2-3)

activities:
  - id: "TASK-01"
    title: "Project Scaffold"
    agent: "scaffolder"
    team_task_ids: [1, 18, 19, 20, 21]
    status: "completed"
    duration_estimate: "20min"
    tags: [project, deployment, testing]
    artifacts:
      - path: "package.json"
        type: "config"
        description: "React 19 + Recharts + Zod + Vitest + Tailwind 4"
      - path: "vite.config.ts"
        type: "config"
        description: "Vite 7 + React plugin + Tailwind CSS plugin"
      - path: "vitest.config.ts"
        type: "config"
        description: "jsdom environment, v8 coverage, test-setup.ts"
      - path: "tsconfig.json"
        type: "config"
      - path: "src/test-setup.ts"
        type: "config"
    depends_on: []
    enables: ["TASK-02", "TASK-03", "TASK-04"]
    summary: "Initialized Vite + React 19 + TypeScript + Tailwind 4 + Vitest project with folder structure (types/, engine/, data/, components/, hooks/)"
    decisions: []

  - id: "TASK-02"
    title: "TypeScript Type Definitions"
    agent: "type-architect"
    team_task_ids: [2]
    status: "completed"
    duration_estimate: "30min"
    tags: [engine, data, clinical-logic, immutability]
    artifacts:
      - path: "src/types/ef-category.ts"
        type: "types"
        description: "EFCategory enum (HFrEF/HFmrEF/HFpEF) + thresholds"
      - path: "src/types/pillar.ts"
        type: "types"
        description: "Pillar enum (4 pillars) + PillarStatus (5 statuses) + color mapping"
      - path: "src/types/blocker.ts"
        type: "types"
        description: "BlockerCode enum (15 codes) + UI labels + categories"
      - path: "src/types/dose-tier.ts"
        type: "types"
        description: "DoseTier enum + points mapping (0/8/16/25)"
      - path: "src/types/patient.ts"
        type: "types"
        description: "PatientSnapshot, Medication, PatientHistory"
      - path: "src/types/audit.ts"
        type: "types"
        description: "AuditResult, PillarResult, GDMTScore"
      - path: "src/types/form-schema.ts"
        type: "types"
        description: "Zod schema for patient form validation"
      - path: "src/types/guideline.ts"
        type: "types"
        description: "GuidelinePosition, GuidelineComparison"
      - path: "src/types/inertia-buster.ts"
        type: "types"
        description: "BarrierInfo type"
      - path: "src/types/index.ts"
        type: "barrel"
        description: "Re-exports all types"
    depends_on: ["TASK-01"]
    enables: ["TASK-03", "TASK-04", "TASK-05", "TASK-06", "TASK-07"]
    summary: "Defined all TypeScript types as readonly interfaces and const enums. 10 type files covering EF categories, pillars, blockers, dose tiers, patient snapshot, audit results, guidelines, and inertia buster."
    decisions: []

  - id: "TASK-03"
    title: "Ruleset JSON + Synthetic Cases + Expected Outputs"
    agent: "data-architect"
    team_task_ids: [3]
    status: "completed"
    duration_estimate: "45min"
    tags: [data, clinical-logic, guidelines, hfref, hfpef]
    artifacts:
      - path: "src/data/ruleset_hf_gdmt_v2.json"
        type: "ruleset"
        description: "All rules with rule_id, guideline_id, class, LOE, thresholds, DOI"
      - path: "src/data/load-ruleset.ts"
        type: "loader"
        description: "TypeScript loader + Zod validation for ruleset"
      - path: "src/data/cases/case1.ts"
        type: "test-data"
        description: "68M HFrEF EF 30% — clinical inertia + UTI barrier"
      - path: "src/data/cases/case2.ts"
        type: "test-data"
        description: "75F HFpEF EF 58% — multi-guideline + finerenone"
      - path: "src/data/cases/case3.ts"
        type: "test-data"
        description: "72M HFrEF EF 25% — multiple real blockers"
      - path: "src/data/expected/case1-expected.ts"
        type: "expected-output"
        description: "GDMT 24/100, 3x CLINICAL_INERTIA, 1x ADR_HISTORY"
      - path: "src/data/expected/case2-expected.ts"
        type: "expected-output"
        description: "SGLT2i MISSING, HFpEF score 0/25"
      - path: "src/data/expected/case3-expected.ts"
        type: "expected-output"
        description: "GDMT 49/100, BP_LOW + K_HIGH + CLINICAL_INERTIA"
      - path: "src/data/index.ts"
        type: "barrel"
    depends_on: ["TASK-02"]
    enables: ["TASK-04", "TASK-05", "TASK-06", "TASK-07", "TASK-08", "TASK-09"]
    summary: "Created structured ruleset JSON with 6 guideline sources and DOIs, 3 synthetic patient cases, and 3 expected output files for integration testing."
    decisions:
      - "DEC-01"
      - "DEC-02"

  - id: "TASK-04"
    title: "Engine: classifyEF() + detectStaleData()"
    agent: "engine-classifier"
    team_task_ids: [4]
    status: "completed"
    duration_estimate: "25min"
    tags: [engine, clinical-logic, tdd, immutability]
    artifacts:
      - path: "src/engine/classify-ef.ts"
        type: "engine-function"
        description: "classifyEF(): EF -> HFrEF/HFmrEF/HFpEF"
      - path: "src/engine/detect-stale.ts"
        type: "engine-function"
        description: "detectStaleData(): labs >14d, vitals >30d detection"
      - path: "src/engine/__tests__/classify-ef.test.ts"
        type: "test"
        description: "Edge cases: EF=0,40,41,49,50,100"
      - path: "src/engine/__tests__/detect-stale.test.ts"
        type: "test"
        description: "Fresh, stale, missing date scenarios"
    depends_on: ["TASK-02"]
    enables: ["TASK-06", "TASK-07", "TASK-09"]
    summary: "TDD-built EF classifier and stale data detector. Pure functions with edge case coverage. Tests written first (RED), then implementation (GREEN)."
    decisions: []

  - id: "TASK-05"
    title: "Engine: getDoseTierPoints() + getEGFRThreshold()"
    agent: "engine-dose"
    team_task_ids: [5]
    status: "completed"
    duration_estimate: "20min"
    tags: [engine, clinical-logic, tdd, gdmt-score]
    artifacts:
      - path: "src/engine/match-dose-tier.ts"
        type: "engine-function"
        description: "getDoseTierPoints(): NOT_PRESCRIBED=0, LOW=8, MEDIUM=16, HIGH=25"
      - path: "src/engine/egfr-thresholds.ts"
        type: "engine-function"
        description: "getEGFRThreshold(): initiation vs continuation per drug class"
      - path: "src/engine/__tests__/match-dose-tier.test.ts"
        type: "test"
      - path: "src/engine/__tests__/egfr-thresholds.test.ts"
        type: "test"
        description: "SGLT2i, MRA, ARNI init vs cont thresholds"
    depends_on: ["TASK-02", "TASK-03"]
    enables: ["TASK-07", "TASK-08"]
    summary: "TDD-built dose tier point mapping and eGFR split logic (EGFR_LOW_INIT vs EGFR_LOW_CONT). Respects per-drug-class thresholds from ruleset."
    decisions: []

  - id: "TASK-06"
    title: "Engine: detectBlockers()"
    agent: "engine-blockers"
    team_task_ids: [6]
    status: "completed"
    duration_estimate: "40min"
    tags: [engine, blockers, clinical-logic, tdd, no-blame]
    artifacts:
      - path: "src/engine/detect-blockers.ts"
        type: "engine-function"
        description: "detectBlockers(): evaluates all 15 blocker codes per pillar"
      - path: "src/engine/__tests__/detect-blockers.test.ts"
        type: "test"
        description: "BP_LOW, HR_LOW, K_HIGH, EGFR thresholds, ADR, ALLERGY, STALE, UNKNOWN, CLINICAL_INERTIA, multi-blocker"
    depends_on: ["TASK-02", "TASK-03", "TASK-04", "TASK-05"]
    enables: ["TASK-07", "TASK-09"]
    summary: "TDD-built blocker detection for all 15 codes. When no clinical/data/patient blocker is found, assigns CLINICAL_INERTIA (displayed as 'No identified blocker'). Supports multiple blockers per pillar."
    decisions: []

  - id: "TASK-07"
    title: "Engine: evaluatePillar()"
    agent: "engine-pillar"
    team_task_ids: [7]
    status: "completed"
    duration_estimate: "35min"
    tags: [engine, clinical-logic, tdd, hfref, hfpef]
    artifacts:
      - path: "src/engine/evaluate-pillar.ts"
        type: "engine-function"
        description: "evaluatePillar(): ON_TARGET/UNDERDOSED/MISSING/CONTRAINDICATED/UNKNOWN"
      - path: "src/engine/__tests__/evaluate-pillar.test.ts"
        type: "test"
        description: "All 5 statuses, HFrEF 4-pillar, HFpEF SGLT2i-only"
    depends_on: ["TASK-04", "TASK-05", "TASK-06"]
    enables: ["TASK-08", "TASK-09"]
    summary: "TDD-built pillar evaluator combining dose tier, blocker detection, and medication presence to determine one of 5 statuses. Handles HFrEF (4 pillars) and HFpEF (SGLT2i only)."
    decisions: []

  - id: "TASK-08"
    title: "Engine: calculateGDMTScore() + HFpEF score"
    agent: "engine-score"
    team_task_ids: [8]
    status: "completed"
    duration_estimate: "35min"
    tags: [engine, gdmt-score, clinical-logic, tdd, hfref, hfpef]
    artifacts:
      - path: "src/engine/calculate-score.ts"
        type: "engine-function"
        description: "calculateGDMTScore(): 0-100, CONTRA exclusion, UNKNOWN flag"
      - path: "src/engine/hfpef-score.ts"
        type: "engine-function"
        description: "calculateHFpEFScore(): separate HFpEF Management Score"
      - path: "src/engine/__tests__/calculate-score.test.ts"
        type: "test"
        description: "All HIGH=100, Case 1=24, Case 3=49, CONTRA exclusion, UNKNOWN"
      - path: "src/engine/__tests__/hfpef-score.test.ts"
        type: "test"
    depends_on: ["TASK-05", "TASK-07"]
    enables: ["TASK-09"]
    summary: "TDD-built GDMT score calculator. CONTRAINDICATED pillars excluded from denominator and score normalized to 0-100. HFpEF uses a separate scoring framework to avoid conflation."
    decisions:
      - "DEC-01"

  - id: "TASK-09"
    title: "Engine: runAudit() Pipeline + Integration Tests"
    agent: "engine-integrator"
    team_task_ids: [9]
    status: "completed"
    duration_estimate: "40min"
    tags: [engine, clinical-logic, testing, hfref, hfpef, immutability]
    artifacts:
      - path: "src/engine/audit.ts"
        type: "engine-function"
        description: "runAudit(): full pipeline — classify EF, evaluate pillars, calculate score, generate questions"
      - path: "src/engine/__tests__/audit.test.ts"
        type: "test"
        description: "Case 1/2/3 integration, HFmrEF, CONTRA exclusion, stale data, immutability"
      - path: "src/engine/index.ts"
        type: "barrel"
        description: "Re-exports all engine functions"
    depends_on: ["TASK-04", "TASK-05", "TASK-06", "TASK-07", "TASK-08"]
    enables: ["TASK-10", "TASK-11", "TASK-13", "TASK-14", "TASK-15", "TASK-16"]
    summary: "Orchestrator function combining all engine modules into a single runAudit() call. Integration tests verify all 3 demo cases match expected outputs. Immutability test confirms no input mutation."
    decisions:
      - "DEC-01"
      - "DEC-02"

  - id: "TASK-10"
    title: "UI: PatientForm + Zod Validation + Quick-Fill"
    agent: "ui-form"
    team_task_ids: [10]
    status: "completed"
    duration_estimate: "30min"
    tags: [ui, data, safety]
    artifacts:
      - path: "src/components/PatientForm.tsx"
        type: "component"
        description: "All patient snapshot fields + medication list + ADR history"
      - path: "src/hooks/usePatientForm.ts"
        type: "hook"
        description: "Form state management"
      - path: "src/types/form-schema.ts"
        type: "types"
        description: "Zod validation schema for patient form"
    depends_on: ["TASK-02", "TASK-03"]
    enables: ["TASK-13"]
    summary: "Patient input form with all DESIGN_SPEC fields: EF, NYHA, vitals+date, labs+date, BNP, DM type, 4 medication slots with dose tiers. Zod validation on submit. Quick-fill buttons for Cases 1/2/3."
    decisions: []

  - id: "TASK-11"
    title: "UI: PillarCard + PillarDashboard + GDMTScore"
    agent: "ui-cards"
    team_task_ids: [11]
    status: "completed"
    duration_estimate: "25min"
    tags: [ui, visualization, gdmt-score, blockers, no-blame]
    artifacts:
      - path: "src/components/PillarCard.tsx"
        type: "component"
        description: "Status badge (color-coded) + blocker labels + click-to-select"
      - path: "src/components/PillarDashboard.tsx"
        type: "component"
        description: "4-card grid layout"
      - path: "src/components/GDMTScore.tsx"
        type: "component"
        description: "Score display with color gradient (red/amber/green) + CONTRA note"
    depends_on: ["TASK-02"]
    enables: ["TASK-13"]
    summary: "Pillar status cards with green/amber/red/gray/purple color mapping. CLINICAL_INERTIA displayed as 'No identified blocker'. GDMT score with color gradient and CONTRA exclusion note."
    decisions: []

  - id: "TASK-12"
    title: "UI: 6 Safety Elements"
    agent: "ui-safety"
    team_task_ids: [12]
    status: "completed"
    duration_estimate: "20min"
    tags: [safety, ui, no-blame, phi-protection]
    artifacts:
      - path: "src/components/DemoModeBadge.tsx"
        type: "component"
        description: "Yellow badge: 'DEMO MODE - SYNTHETIC DATA ONLY' (always visible)"
      - path: "src/components/DisclaimerBanner.tsx"
        type: "component"
        description: "Sticky top banner: 'Clinical audit tool. All outputs require physician review.'"
      - path: "src/components/labels/AIGeneratedLabel.tsx"
        type: "component"
        description: "'This explanation is AI-generated'"
      - path: "src/components/labels/RuleDerivedLabel.tsx"
        type: "component"
        description: "'Derived from Guideline-as-Code ruleset v2'"
      - path: "src/components/labels/DraftWatermark.tsx"
        type: "component"
        description: "'DRAFT - Pending physician review'"
      - path: "src/components/labels/BlockerLabel.tsx"
        type: "component"
        description: "Blocker code to user-friendly label mapping"
      - path: "src/components/labels/index.ts"
        type: "barrel"
    depends_on: []
    enables: ["TASK-13", "TASK-14", "TASK-15", "TASK-16"]
    summary: "All 6 non-negotiable safety UI elements: DemoModeBadge, DisclaimerBanner, AIGeneratedLabel, RuleDerivedLabel, DraftWatermark, and no-blame CLINICAL_INERTIA label transform."
    decisions: []

  - id: "TASK-13"
    title: "UI: Dashboard 3-Pane Layout + DetailPanel + Wiring"
    agent: "ui-layout"
    team_task_ids: [13]
    status: "completed"
    duration_estimate: "30min"
    tags: [ui, visualization, safety]
    artifacts:
      - path: "src/components/Dashboard.tsx"
        type: "component"
        description: "3-pane layout (25%/45%/30%) — form, score+pillars, detail panel"
      - path: "src/components/DetailPanel.tsx"
        type: "component"
        description: "Right pane: inertia buster, pictograph, guideline comparison, missing info"
      - path: "src/App.tsx"
        type: "component"
        description: "Root component rendering Dashboard"
      - path: "src/main.tsx"
        type: "entry"
    depends_on: ["TASK-09", "TASK-10", "TASK-11", "TASK-12"]
    enables: ["TASK-14", "TASK-15", "TASK-16"]
    summary: "Wired form submit -> runAudit() -> dashboard state update. 3-pane responsive layout. DemoModeBadge and DisclaimerBanner integrated at top level. Pillar click selects for detail panel."
    decisions: []

  - id: "TASK-14"
    title: "Feature: Inertia Buster + ReasonInput"
    agent: "feat-inertia"
    team_task_ids: [14]
    status: "completed"
    duration_estimate: "40min"
    tags: [inertia-buster, blockers, no-blame, data, ui]
    artifacts:
      - path: "src/components/InertiaBuster.tsx"
        type: "component"
        description: "Expandable barrier cards with information, options, warnings"
      - path: "src/components/ReasonInput.tsx"
        type: "component"
        description: "Multi-select + free-text reason documentation per pillar"
      - path: "src/engine/get-inertia-info.ts"
        type: "engine-function"
        description: "Lookup barrier info by pillar + blocker code"
      - path: "src/data/inertia-buster-sglt2i.ts"
        type: "data"
        description: "SGLT2i barrier content (UTI, GI, hypo, eGFR, never considered)"
      - path: "src/data/inertia-buster-arni.ts"
        type: "data"
        description: "ARNI/ACEi/ARB barrier content"
      - path: "src/data/inertia-buster-bb.ts"
        type: "data"
        description: "Beta-blocker barrier content"
      - path: "src/data/inertia-buster-mra.ts"
        type: "data"
        description: "MRA barrier content"
    depends_on: ["TASK-06", "TASK-12", "TASK-13"]
    enables: ["TASK-16"]
    summary: "Inertia Buster displays barrier-specific clinical information (NOT recommendations). Expandable cards with evidence, practical options, and 'when not to' warnings. ReasonInput supports multi-select + free-text per pillar. All 4 pillars covered."
    decisions: []

  - id: "TASK-15"
    title: "Feature: Pictograph + Multi-Guideline + Case 2"
    agent: "feat-visual"
    team_task_ids: [15]
    status: "completed"
    duration_estimate: "40min"
    tags: [visualization, guidelines, hfpef, data, ui]
    artifacts:
      - path: "src/components/Pictograph.tsx"
        type: "component"
        description: "100-person icon grid (10x10) — green benefit, red harm, gray neutral"
      - path: "src/components/GuidelineComparison.tsx"
        type: "component"
        description: "Side-by-side AHA vs ESC with 'Guidelines differ' badge"
      - path: "src/data/pictograph-sglt2i-hfref.ts"
        type: "data"
        description: "DAPA-HF + EMPEROR-R trial data (5 benefit, 2 harm per 100)"
      - path: "src/data/guideline-differences.ts"
        type: "data"
        description: "4 known guideline differences (SGLT2i HFpEF, finerenone, ARNI, rapid sequence)"
    depends_on: ["TASK-08", "TASK-12", "TASK-13"]
    enables: ["TASK-16"]
    summary: "Single SGLT2i pictograph (DAPA-HF+EMPEROR-R, benefit vs infection). Multi-guideline comparison shows AHA 2a vs ESC I for SGLT2i in HFpEF, finerenone ESC IIa. Differences highlighted with amber badge."
    decisions: []

  - id: "TASK-16"
    title: "Feature: LLM Integration + Export Formats"
    agent: "feat-deploy"
    team_task_ids: [16]
    status: "completed"
    duration_estimate: "40min"
    tags: [deployment, phi-protection, safety, engine]
    artifacts:
      - path: "src/engine/prepare-llm-context.ts"
        type: "engine-function"
        description: "Strips all patient values, keeps only status codes + blocker codes"
      - path: "src/hooks/useLLMExplanation.ts"
        type: "hook"
        description: "Claude API call with PHI-safe context, graceful degradation"
      - path: "src/components/LLMExplanation.tsx"
        type: "component"
        description: "Display with AI-generated label, loading/error states"
      - path: "src/components/ExportButton.tsx"
        type: "component"
        description: "One-click export: SOAP, problem-list, JSON formats"
      - path: "src/engine/export-soap.ts"
        type: "engine-function"
        description: "SOAP-style clinical documentation export with DRAFT watermark"
      - path: "src/engine/export-problem-list.ts"
        type: "engine-function"
        description: "Problem-list style export"
      - path: "src/engine/export-json.ts"
        type: "engine-function"
        description: "Raw JSON export for integration/archival"
      - path: "src/engine/__tests__/prepare-llm-context.test.ts"
        type: "test"
        description: "Verifies NO patient values in LLM context"
      - path: "src/engine/__tests__/export-soap.test.ts"
        type: "test"
      - path: "src/engine/__tests__/export-problem-list.test.ts"
        type: "test"
      - path: "src/engine/__tests__/export-json.test.ts"
        type: "test"
    depends_on: ["TASK-09", "TASK-12", "TASK-13"]
    enables: []
    summary: "LLM integration with PHI-safe context (only abstract codes sent to Claude API). Graceful degradation if API unavailable. Three export formats (SOAP, problem-list, JSON) all include DRAFT watermark and SYNTHETIC DATA notice."
    decisions: []

  - id: "TASK-17"
    title: "i18n + ARNI/ACEi_ARB Pillar Merge + Domain Architecture"
    agent: "multi-feature"
    team_task_ids: [17]
    status: "completed"
    duration_estimate: "90min"
    tags: [i18n, engine, ui, data, clinical-logic, fhir]
    artifacts:
      - path: "src/i18n/"
        type: "i18n"
        description: "i18next setup with EN/JA locales, runtime language switching"
      - path: "src/i18n/locales/en/ui.json"
        type: "i18n"
        description: "English UI translations"
      - path: "src/i18n/locales/ja/ui.json"
        type: "i18n"
        description: "Japanese UI translations"
      - path: "src/components/LanguageSwitcher.tsx"
        type: "component"
        description: "EN/JA toggle button"
      - path: "src/types/pillar.ts"
        type: "types"
        description: "Merged ARNI + ACEi_ARB into single ARNI_ACEi_ARB pillar"
      - path: "src/fhir/"
        type: "fhir"
        description: "FHIR R4 mock bundles + fhir-to-snapshot converter"
      - path: "src/engine/parse-vision-response.ts"
        type: "engine-function"
        description: "Zod-validated vision API response parser"
      - path: "src/domain/"
        type: "architecture"
        description: "ClinicalDomain + registry pattern for extensibility"
    depends_on: ["TASK-09", "TASK-13"]
    enables: ["TASK-18", "TASK-20", "TASK-21", "TASK-22", "TASK-23", "TASK-24"]
    summary: "Major multi-feature commit: i18next with EN/JA, ARNI+ACEi/ARB pillar merge (5→4), FHIR R4 mock bundles, vision API response parser, ClinicalDomain registry, patient timeline, stale data alerts. All tests updated for pillar merge."
    decisions: []

  - id: "TASK-18"
    title: "InertiaActionPlan + Visit Summary"
    agent: "feat-action"
    team_task_ids: [18]
    status: "completed"
    duration_estimate: "45min"
    tags: [ui, engine, clinical-logic, no-blame]
    artifacts:
      - path: "src/components/InertiaActionPlan.tsx"
        type: "component"
        description: "Action item cards with Accept/Defer/N-A decision buttons + visit summary"
      - path: "src/components/ActionItemCard.tsx"
        type: "component"
        description: "Individual action item with decision state management"
      - path: "src/components/VisitSummary.tsx"
        type: "component"
        description: "Decision summary after all items resolved"
      - path: "src/engine/generate-action-plan.ts"
        type: "engine-function"
        description: "Generates prioritized action items from audit result"
      - path: "src/engine/__tests__/generate-action-plan.test.ts"
        type: "test"
        description: "Action plan generation tests"
    depends_on: ["TASK-09", "TASK-17"]
    enables: ["TASK-24"]
    summary: "InertiaActionPlan with per-pillar action items (Accept/Defer/N-A decisions), free-text reason input for Defer, visit summary showing all decisions. Drives the Pre-Visit Note generation workflow."
    decisions: []

  - id: "TASK-19"
    title: "Dose Tier Label Rename (Low→Minimum, High→Max)"
    agent: "refactor-labels"
    team_task_ids: [19]
    status: "completed"
    duration_estimate: "10min"
    tags: [ui, data, clinical-logic, gdmt-score]
    artifacts:
      - path: "src/types/dose-tier.ts"
        type: "types"
        description: "Label map updated: Low→Minimum dose, Medium→Intermediate, High→Maximum (target)"
    depends_on: ["TASK-02"]
    enables: []
    summary: "Renamed dose tier UI labels for clinical accuracy: Low→Minimum dose, Medium→Intermediate, High→Maximum (target). Internal enum values unchanged."
    decisions: []

  - id: "TASK-20"
    title: "Rive Mascot Character (Duolingo-style)"
    agent: "feat-mascot"
    team_task_ids: [20]
    status: "completed"
    duration_estimate: "60min"
    tags: [ui, engine, mascot, visualization]
    artifacts:
      - path: "src/types/mascot.ts"
        type: "types"
        description: "MascotEmotion type (IDLE/THINKING/CELEBRATING/CONCERNED/POINTING/HAPPY)"
      - path: "src/engine/derive-mascot-emotion.ts"
        type: "engine-function"
        description: "Pure function: audit state → MascotEmotion with priority system"
      - path: "src/engine/__tests__/derive-mascot-emotion.test.ts"
        type: "test"
        description: "9 test cases covering all emotions and priority overrides"
      - path: "src/hooks/useMascotState.ts"
        type: "hook"
        description: "Mascot visibility, dismiss/restore, hover state management"
      - path: "src/components/Mascot.tsx"
        type: "component"
        description: "Rive animated character with speech bubbles, dismiss button"
      - path: "src/components/MascotRestoreButton.tsx"
        type: "component"
        description: "Small restore button shown after mascot dismissed"
      - path: "public/mascot.riv"
        type: "asset"
        description: "Little Fella Rive animation (CC BY 4.0)"
    depends_on: ["TASK-09", "TASK-17"]
    enables: []
    summary: "Duolingo-style mascot using Rive (@rive-app/react-canvas-lite, ~44kB). State-machine driven emotions reacting to audit state. Speech bubbles with i18n messages. Dismiss/restore functionality. Hidden on mobile."
    decisions:
      - "DEC-07"

  - id: "TASK-21"
    title: "Clinical Professional Design Profile"
    agent: "design-updater"
    team_task_ids: [21]
    status: "completed"
    duration_estimate: "45min"
    tags: [ui, design, visualization]
    artifacts:
      - path: "index.html"
        type: "config"
        description: "Google Fonts changed: Inter → Lato + Noto Sans JP + Roboto Mono"
      - path: "src/index.css"
        type: "styles"
        description: "Font theme updated to Lato/Noto Sans JP/Roboto Mono"
    depends_on: ["TASK-13"]
    enables: []
    summary: "Applied Clinical Professional design profile across ~22 component files. Font: Lato+Noto Sans JP (humanist). Color: blue→teal primary interactive. Radius: rounded-xl→rounded-lg. Depth: shadow removed, border-gray-200 as separator. Numbers: font-mono on scores. Preserved semantic blues for pillar identity."
    decisions:
      - "DEC-08"

  - id: "TASK-22"
    title: "Top Navigation Bar (AppHeader)"
    agent: "ui-nav"
    team_task_ids: [22]
    status: "completed"
    duration_estimate: "30min"
    tags: [ui, design, safety]
    artifacts:
      - path: "src/components/AppHeader.tsx"
        type: "component"
        description: "Fixed top nav: heartbeat icon, app title, Dashboard/Patients/Reports tabs, DemoModeBadge, LanguageSwitcher"
      - path: "src/components/Dashboard.tsx"
        type: "component"
        description: "Modified: moved DemoModeBadge/LanguageSwitcher to AppHeader, added pt-14 offset"
    depends_on: ["TASK-13", "TASK-17", "TASK-21"]
    enables: []
    summary: "Top navigation bar with heartbeat icon, 'Clinical Audit v2.4' title, tab navigation (Dashboard/Patients/Reports), integrated DemoModeBadge and LanguageSwitcher. z-50 fixed positioning."
    decisions: []

  - id: "TASK-23"
    title: "BNP/NT-proBNP Biomarker Switcher"
    agent: "feat-biomarker"
    team_task_ids: [23]
    status: "completed"
    duration_estimate: "30min"
    tags: [ui, data, clinical-logic, fhir]
    artifacts:
      - path: "src/types/patient.ts"
        type: "types"
        description: "Added ntProBnp optional field to PatientSnapshot"
      - path: "src/types/form-schema.ts"
        type: "types"
        description: "Added ntProBnp Zod validation"
      - path: "src/hooks/usePatientForm.ts"
        type: "hook"
        description: "Added biomarkerType toggle, clearing logic on switch"
      - path: "src/components/PatientForm.tsx"
        type: "component"
        description: "Combined biomarker selector dropdown + value input"
      - path: "src/fhir/types.ts"
        type: "types"
        description: "Added NT_PRO_BNP LOINC code (33762-6)"
      - path: "src/fhir/fhir-to-snapshot.ts"
        type: "fhir"
        description: "Added NT-proBNP observation lookup"
      - path: "src/engine/parse-vision-response.ts"
        type: "engine-function"
        description: "Added ntProBnp to vision schema and mapping"
    depends_on: ["TASK-10", "TASK-17"]
    enables: []
    summary: "BNP/NT-proBNP biomarker type switcher. Dropdown selects biomarker type with reference range hints (BNP >100, NT-proBNP >300 pg/mL). Switching clears both values. Integrated across form, vision parser, FHIR converter."
    decisions: []

  - id: "TASK-24"
    title: "Pre-Visit Planning Note + FHIR CarePlan Export"
    agent: "feat-previsit"
    team_task_ids: [24]
    status: "completed"
    duration_estimate: "60min"
    tags: [engine, ui, fhir, pre-visit-note, phi-protection, clinical-logic]
    artifacts:
      - path: "src/types/pre-visit-note.ts"
        type: "types"
        description: "MedicationChangeType, MedicationPlan, PatientExplanation, PreVisitNote types"
      - path: "src/engine/generate-pre-visit-note.ts"
        type: "engine-function"
        description: "Pure function: audit + actions + decisions + medications → PreVisitNote"
      - path: "src/engine/__tests__/generate-pre-visit-note.test.ts"
        type: "test"
        description: "19 tests: INITIATE, UPTITRATE, defer, N/A, monitoring, side effects, immutability"
      - path: "src/fhir/build-careplan.ts"
        type: "fhir"
        description: "PreVisitNote → FHIR R4 CarePlan with MedicationRequest activities"
      - path: "src/components/PreVisitNotePanel.tsx"
        type: "component"
        description: "Preview panel: med plans, patient explanations, deferred items, copy+send buttons"
      - path: "src/components/InertiaActionPlan.tsx"
        type: "component"
        description: "Modified: added Generate Pre-Visit Note button + mock FHIR POST"
    depends_on: ["TASK-09", "TASK-17", "TASK-18"]
    enables: ["TASK-25"]
    summary: "Pre-visit planning note (予習カルテ): generates medication adjustment plan (INITIATE/UPTITRATE) + patient explanations with side effects/monitoring + deferred items. Exports as FHIR R4 CarePlan with MedicationRequest activities. PHI-safe: only drug names and status codes, no patient values."
    decisions: []
    error_patterns:
      - "i18n type error: CHANGE_LABEL_KEYS typed as Record widened values to string. Fix: as const satisfies Readonly<Record<K, string>> preserves literal types."
      - "i18n TranslateFn: t() function type from useTranslation() incompatible with (key: string) => string. Fix: type alias TranslateFn + cast (t as unknown as TranslateFn)."

  - id: "TASK-25"
    title: "Patient List Sidebar + Layout Restructuring"
    agent: "layout-restructure"
    team_task_ids: [25]
    status: "completed"
    duration_estimate: "45min"
    tags: [ui, fhir, data, design]
    artifacts:
      - path: "src/types/appointment.ts"
        type: "types"
        description: "AppointmentPatient interface + PatientSource type for sidebar patient list"
      - path: "src/data/mock-appointments.ts"
        type: "data"
        description: "getAppointmentList() (demo+FHIR), getDemoCaseData() lookup for sidebar"
      - path: "src/components/PatientListSidebar.tsx"
        type: "component"
        description: "Persistent left sidebar: demo cases (teal), EHR patients (blue), manual entry + image upload buttons"
      - path: "src/components/Dashboard.tsx"
        type: "component"
        description: "Major rewrite: 3-pane layout (LEFT 20% sidebar | CENTER flex-1 form+results | RIGHT 30% detail)"
      - path: "src/components/PatientForm.tsx"
        type: "component"
        description: "Modified: added preloadedPatient prop, collapsible medications, removed demo presets"
      - path: "src/components/AppHeader.tsx"
        type: "component"
        description: "Modified: nav.patients tab set to active"
    deleted_files:
      - path: "src/components/FHIRPatientList.tsx"
        reason: "Replaced by PatientListSidebar"
      - path: "src/hooks/useFHIRConnect.ts"
        reason: "Replaced by direct fetchPatientEverything in Dashboard"
      - path: "src/components/EHRConnectButton.tsx"
        reason: "Integrated into PatientListSidebar footer"
    depends_on: ["TASK-17", "TASK-22"]
    enables: []
    summary: "Layout restructuring from modal-based EHR workflow to persistent 3-pane layout. LEFT sidebar (20%) shows today's patients (demo cases + FHIR EHR patients) with one-click selection. CENTER pane contains PatientForm (now with preloadedPatient auto-fill + collapsible medications) and audit results (GDMTScore, ActionPlan, PillarDashboard). RIGHT pane unchanged (DetailPanel + Timeline). Demo case selection triggers instant load + auto-audit. FHIR patient selection triggers async fetch + auto-audit. Deleted 3 deprecated files (FHIRPatientList, useFHIRConnect, EHRConnectButton)."
    decisions: ["DEC-10"]
    error_patterns:
      - "Unused state variable: dataSource declared but never read after removing EHRConnectButton. Fix: removed dataSource state and all setDataSource calls entirely."

# ===== DECISIONS LOG =====
# Key decisions and items requiring MD review

decisions:
  - id: "DEC-01"
    title: "Case 3 GDMT Score: 49 vs 41"
    context: "DESIGN_SPEC v2.1 states GDMT 41/100 for Case 3, but mathematical formula gives 49. Case 3 has ARNI LOW (8) + BB LOW (8) + MRA LOW (8) + SGLT2i HIGH (25) = 49/100."
    resolution: "Using 49 (mathematically correct per the dose tier point system defined in Section 4.2). The spec's 41 appears to be a manual calculation error. Flagged for MD review."
    status: "requires_md_review"
    tags: [clinical-logic, gdmt-score, hfref]
    related_tasks: ["TASK-03", "TASK-08", "TASK-09"]

  - id: "DEC-02"
    title: "Case 3 BB Blocker: CLINICAL_INERTIA (not BP_LOW)"
    context: "DESIGN_SPEC says BB should have BP_LOW blocker, but BB threshold bp_low_sbp is 90 (ruleset R-004) and Case 3 SBP is 92. 92 >= 90 means BP_LOW does not trigger."
    resolution: "Engine assigns CLINICAL_INERTIA to BB. This is mathematically correct per the ruleset. If threshold should be higher (e.g., 95), ruleset R-004 needs adjustment. MD to decide."
    status: "requires_md_review"
    tags: [clinical-logic, blockers, hfref]
    related_tasks: ["TASK-06", "TASK-09"]

  - id: "DEC-03"
    title: "DESIGN_SPEC Case 3 MRA Status: ON_TARGET vs UNDERDOSED"
    context: "DESIGN_SPEC describes MRA as 'ON_TARGET (with alert)' for K_HIGH, but Spironolactone is at LOW dose tier (12.5mg). LOW != ON_TARGET."
    resolution: "Engine correctly marks MRA as UNDERDOSED with K_HIGH blocker. ON_TARGET requires HIGH dose tier. MD to confirm: should K_HIGH override status to a special 'ON_TARGET_WITH_ALERT'?"
    status: "requires_md_review"
    tags: [clinical-logic, blockers, hfref]
    related_tasks: ["TASK-07", "TASK-09"]

  - id: "DEC-04"
    title: "HFpEF Pillar Scope: SGLT2i Only"
    context: "For HFpEF (EF >= 50%), the 4-pillar HFrEF model does not directly apply. DESIGN_SPEC Section 2.2 says SGLT2i audit + finerenone opportunity + comorbidity."
    resolution: "Engine evaluates only SGLT2i pillar for HFpEF. Finerenone is surfaced through GuidelineComparison data, not as a formal pillar. HFpEF Management Score is separate from HFrEF GDMT Score."
    status: "implemented"
    tags: [clinical-logic, hfpef, guidelines]
    related_tasks: ["TASK-07", "TASK-08", "TASK-15"]

  - id: "DEC-05"
    title: "Pictograph Numbers: 5 benefit, 2 harm per 100"
    context: "DAPA-HF + EMPEROR-Reduced combined data. Benefit = composite of worsening HF + CV death prevented. Harm = urogenital infection."
    resolution: "Using 5/100 benefit and 2/100 harm as placeholder values. Disclaimer notes infection risk was small and inconsistent. MD to validate exact numbers against published trial data."
    status: "requires_md_review"
    tags: [visualization, data, hfref]
    related_tasks: ["TASK-15"]

  - id: "DEC-06"
    title: "React 19 + Tailwind 4 + Vite 7 (Latest Stack)"
    context: "CLAUDE.md specifies React 18 + Tailwind CSS, but latest stable versions are React 19, Tailwind 4, and Vite 7."
    resolution: "Used latest stable versions (React 19.2, Tailwind 4.1, Vite 7.3) for better performance and Tailwind 4's native CSS support. No breaking changes for this project scope."
    status: "implemented"
    tags: [project, deployment]
    related_tasks: ["TASK-01"]

  - id: "DEC-07"
    title: "Rive over Three.js for Mascot Animation"
    context: "Duolingo-style mascot needed 2D animation with state machine control. Options: Three.js (~400kB), Lottie (~60kB), Rive (~44kB)."
    resolution: "Chose Rive (@rive-app/react-canvas-lite). Same tech as Duolingo. Smallest bundle, native state machine support, community assets available (Little Fella CC BY 4.0). Three.js overkill for 2D character."
    status: "implemented"
    tags: [ui, mascot, visualization]
    related_tasks: ["TASK-20"]

  - id: "DEC-08"
    title: "Teal over Blue for Primary Interactive Color"
    context: "Clinical Professional design profile requires differentiation from generic tech-blue UI. Teal conveys clinical competence without the aggressive blue common in SaaS apps."
    resolution: "Primary interactive: teal-600/700. Preserved semantic blues: ARNI pillar accent (blue-500), low priority badges (blue-100), citation badges (blue-50). Font changed to Lato + Noto Sans JP (humanist). Roboto Mono for tabular numbers."
    status: "implemented"
    tags: [ui, design, visualization]
    related_tasks: ["TASK-21"]

  - id: "DEC-09"
    title: "FHIR R4 CarePlan as Pre-Visit Note Export Target"
    context: "Pre-visit planning note needs to be exportable to EHR systems. Options: plain text, HL7v2 message, FHIR R4 CarePlan, CDA document."
    resolution: "Chose FHIR R4 CarePlan with MedicationRequest activities. Modern standard, widely supported by EHR vendors. Activities map naturally to medication adjustment plans. Notes field carries patient explanations."
    status: "implemented"
    tags: [fhir, pre-visit-note, deployment]
    related_tasks: ["TASK-24"]

  - id: "DEC-10"
    title: "Persistent Left Sidebar over Modal for Patient Selection"
    context: "Previous design used FHIRPatientList modal for EHR patient browsing, requiring open/close clicks. Clinical workflow is sequential: select patient → review GDMT → act. A persistent sidebar better matches the exam-room workflow."
    resolution: "Replaced modal with persistent PatientListSidebar (20% width). Demo cases and FHIR patients displayed in unified list with section headers. One click loads patient data and auto-runs audit. Three deprecated components deleted."
    status: "implemented"
    tags: [ui, design, fhir]
    related_tasks: ["TASK-25"]

# ===== METRICS =====
metrics:
  tasks:
    total: 25
    completed: 25
    blocked: 0
  tests:
    total: 323
    passing: 323
    failing: 0
    test_files: 25
  coverage:
    engine_statements: "100%"
    engine_branches: "96.81%"
    engine_functions: "100%"
    engine_lines: "100%"
    overall_statements: "98.03%"
    overall_branches: "95.59%"
    overall_functions: "89.58%"
  files:
    types: 17
    engine: 24
    engine_tests: 25
    components: 39
    data: 21
    hooks: 8
    fhir: 7
    i18n: 8
    config: 4
    total_src: 148
  tech_stack:
    react: "19.2"
    typescript: "5.9"
    tailwind: "4.1"
    vite: "7.3"
    vitest: "4.0"
    zod: "4.3"
    recharts: "3.7"
    i18next: "25.8"
    react-i18next: "16.5"
    rive: "4.27"
  safety_elements:
    count: 6
    list:
      - "DemoModeBadge (yellow, always visible, in AppHeader)"
      - "DisclaimerBanner (sticky top)"
      - "AIGeneratedLabel (on LLM text)"
      - "RuleDerivedLabel (on engine output)"
      - "DraftWatermark (on reports/exports/pre-visit notes)"
      - "No-blame CLINICAL_INERTIA label"
  demo_cases:
    count: 3
    case1: "68M HFrEF EF 30% — GDMT 24/100, 3x CLINICAL_INERTIA, SGLT2i ADR_HISTORY (UTI)"
    case2: "75F HFpEF EF 58% — SGLT2i MISSING, AHA 2a vs ESC I, finerenone ESC IIa"
    case3: "72M HFrEF EF 25% — GDMT 49/100, BP_LOW + K_HIGH, appropriate non-escalation"
  agents_used:
    total: 24
    list:
      - "scaffolder"
      - "type-architect"
      - "data-architect"
      - "engine-classifier"
      - "engine-dose"
      - "engine-blockers"
      - "engine-pillar"
      - "engine-score"
      - "engine-integrator"
      - "ui-form"
      - "ui-cards"
      - "ui-safety"
      - "ui-layout"
      - "feat-inertia"
      - "feat-visual"
      - "feat-deploy"
      - "multi-feature"
      - "feat-action"
      - "refactor-labels"
      - "feat-mascot"
      - "design-updater"
      - "ui-nav"
      - "feat-biomarker"
      - "feat-previsit"
      - "layout-restructure"

# ===== ERROR PATTERNS =====
# Recurring issues and their solutions, to prevent repeat mistakes.
error_patterns:
  - id: "ERR-01"
    title: "i18next strict TypeScript literal key types"
    trigger: "Using mapped i18n keys (e.g., t(KEYS[variable])) with const record objects"
    symptom: "TS2345: Argument of type 'string' is not assignable to parameter of type literal union"
    cause: "Readonly<Record<K, string>> widens values to 'string', losing literal types"
    fix: "Use 'as const satisfies Readonly<Record<K, string>>' to preserve literal types"
    affected_files: ["Mascot.tsx", "ActionItemCard.tsx", "PreVisitNotePanel.tsx"]
    occurrences: 3
    tags: [i18n, ui]

  - id: "ERR-02"
    title: "i18next t() function type incompatibility in helper functions"
    trigger: "Passing useTranslation().t to a helper function typed as (key: string) => string"
    symptom: "TS2345: t function type not assignable to simpler function signature"
    cause: "react-i18next t() has complex overloaded signature with literal key unions"
    fix: "Define TranslateFn = (key: string, options?: Record<string, unknown>) => string, cast with (t as unknown as TranslateFn)"
    affected_files: ["PreVisitNotePanel.tsx"]
    occurrences: 1
    tags: [i18n, ui]

  - id: "ERR-03"
    title: "Unused state variable after component deletion"
    trigger: "Removing a component that was the sole consumer of a state variable"
    symptom: "TS6133: 'dataSource' is declared but its value is never read"
    cause: "State was set in handlers but only read by the deleted EHRConnectButton component"
    fix: "Remove the useState declaration and all setter calls when the reader is deleted"
    affected_files: ["Dashboard.tsx"]
    occurrences: 1
    tags: [ui]

# ===== TAG INDEX =====
# Reverse index: for each tag, which tasks and decisions reference it.
# Enables "show me everything related to [X]" queries.
tag_index:
  project: { tasks: ["TASK-01"], decisions: ["DEC-06"] }
  engine: { tasks: ["TASK-04", "TASK-05", "TASK-06", "TASK-07", "TASK-08", "TASK-09", "TASK-16", "TASK-17", "TASK-20", "TASK-24"], decisions: [] }
  ui: { tasks: ["TASK-10", "TASK-11", "TASK-13", "TASK-14", "TASK-15", "TASK-17", "TASK-18", "TASK-19", "TASK-20", "TASK-21", "TASK-22", "TASK-23", "TASK-24", "TASK-25"], decisions: ["DEC-07", "DEC-08", "DEC-10"], errors: ["ERR-03"] }
  safety: { tasks: ["TASK-10", "TASK-12", "TASK-13", "TASK-16", "TASK-22"], decisions: [] }
  data: { tasks: ["TASK-02", "TASK-03", "TASK-14", "TASK-15", "TASK-17", "TASK-19", "TASK-23", "TASK-25"], decisions: ["DEC-05"] }
  testing: { tasks: ["TASK-01", "TASK-04", "TASK-09"], decisions: [] }
  deployment: { tasks: ["TASK-01", "TASK-16"], decisions: ["DEC-06", "DEC-09"] }
  clinical-logic: { tasks: ["TASK-02", "TASK-03", "TASK-04", "TASK-05", "TASK-06", "TASK-07", "TASK-08", "TASK-09", "TASK-17", "TASK-18", "TASK-19", "TASK-23", "TASK-24"], decisions: ["DEC-01", "DEC-02", "DEC-03", "DEC-04"] }
  visualization: { tasks: ["TASK-11", "TASK-13", "TASK-15", "TASK-20", "TASK-21"], decisions: ["DEC-05", "DEC-07", "DEC-08"] }
  phi-protection: { tasks: ["TASK-12", "TASK-16", "TASK-24"], decisions: [] }
  no-blame: { tasks: ["TASK-06", "TASK-11", "TASK-12", "TASK-14", "TASK-18"], decisions: [] }
  guidelines: { tasks: ["TASK-03", "TASK-15"], decisions: ["DEC-04"] }
  blockers: { tasks: ["TASK-06", "TASK-11", "TASK-14"], decisions: ["DEC-02", "DEC-03"] }
  tdd: { tasks: ["TASK-04", "TASK-05", "TASK-06", "TASK-07", "TASK-08"], decisions: [] }
  immutability: { tasks: ["TASK-02", "TASK-04", "TASK-09"], decisions: [] }
  hfref: { tasks: ["TASK-04", "TASK-07", "TASK-08", "TASK-09"], decisions: ["DEC-01", "DEC-02", "DEC-03", "DEC-05"] }
  hfpef: { tasks: ["TASK-03", "TASK-07", "TASK-08", "TASK-15"], decisions: ["DEC-04"] }
  gdmt-score: { tasks: ["TASK-05", "TASK-08", "TASK-11", "TASK-19"], decisions: ["DEC-01"] }
  inertia-buster: { tasks: ["TASK-14"], decisions: [] }
  i18n: { tasks: ["TASK-17"], decisions: [], errors: ["ERR-01", "ERR-02"] }
  fhir: { tasks: ["TASK-17", "TASK-23", "TASK-24", "TASK-25"], decisions: ["DEC-09", "DEC-10"] }
  design: { tasks: ["TASK-21", "TASK-22", "TASK-25"], decisions: ["DEC-08", "DEC-10"] }
  mascot: { tasks: ["TASK-20"], decisions: ["DEC-07"] }
  pre-visit-note: { tasks: ["TASK-24"], decisions: ["DEC-09"] }
